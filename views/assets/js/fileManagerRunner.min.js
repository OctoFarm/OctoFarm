!function e(t,n,a){function r(o,c){if(!n[o]){if(!t[o]){var l="function"==typeof require&&require;if(!c&&l)return l(o,!0);if(i)return i(o,!0);var s=new Error("Cannot find module '"+o+"'");throw s.code="MODULE_NOT_FOUND",s}var u=n[o]={exports:{}};t[o][0].call(u.exports,(function(e){return r(t[o][1][e]||e)}),u,u.exports,e,t,n,a)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<a.length;o++)r(a[o]);return r}({1:[function(e,t,n){"use strict";var a=s(e("./lib/octofarm.js")),r=s(e("./lib/functions/calc.js")),i=s(e("./lib/modules/fileManager.js")),o=e("./lib/functions/dragAndDrop.js"),c=e("./lib/modules/filamentGrab.js"),l=s(e("./lib/modules/fileSorting.js"));function s(e){return e&&e.__esModule?e:{default:e}}function u(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){u(i,a,r,o,c,"next",e)}function c(e){u(i,a,r,o,c,"throw",e)}o(void 0)}))}}function f(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var p=null;document.getElementById("multUploadBtn").addEventListener("click",(function(e){i.default.multiUpload()})),function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,s,u,m;return t=e,n=null,s=[{key:"init",value:(m=d(regeneratorRuntime.mark((function t(){var n,r,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.default.post("printers/printerInfo",{});case 2:return n=t.sent,t.next=5,n.json();case 5:return n=t.sent,t.next=8,(0,c.returnDropDown)();case 8:r=t.sent,s=document.getElementById("printerList"),n.forEach((function(t){if("Offline"!==t.printerState.colour.category){for(var l="",u=0;u<t.currentProfile.extruder.count;u++)l+='<div class="input-group mb-1"> <div class="input-group-prepend"> <label class="input-group-text bg-secondary text-light" for="tool'.concat(u,"-").concat(t._id,'">Filament:</label> </div> <select class="custom-select bg-secondary text-light" id="tool').concat(u,"-").concat(t._id,'"></select></div>');s.insertAdjacentHTML("beforeend",'\n        <a\n            data-jplist-item\n            id="fileManagerPrinter-'.concat(t._id,'"\n            class="list-group-item list-group-item-action flex-column align-items-start bg-secondary"\n            style="display: block;\n            padding: 0.7rem 0.1rem;"\n          >\n            <div class="row">\n              <div\n                class="col-lg-2"\n                style="display:flex; justify-content:center; align-items:center;"\n              >\n                <center><i class="fas fa-print fa-2x"></i><br>\n                <td><small><span title="').concat(t.printerState.desc,'" id="printerBadge-').concat(t._id,'" class="tag badge badge-').concat(t.printerState.colour.name," badge-pill ").concat(t.printerState.colour.category,'">\n                        ').concat(t.printerState.state,'</span></small></td></center>\n              </div>\n              <div class="col-lg-10">\n                <div class="d-flex w-100 justify-content-between">\n                  <h5 class="mb-1">\n                    <span id="printerName-').concat(t._id,'">\n                        ').concat(t.printerName,'\n                    </span>\n        \n                  </h5>\n                  <small>\n                    <span class="float-right badge badge-dark badge-pill">\n                        Files: ').concat(t.fileList.filecount," / Folders: ").concat(t.fileList.folderCount,'\n                    </span></small\n                  >\n                </div>\n        \n                <div\n                  class="float-right btn-group flex-wrap btn-group-sm"\n                  role="group"\n                  aria-label="Basic example"\n                >\n                 \n        \n                </div>\n                <div class="row">\n                  <div class="col-lg-2">\n                    <i class="fas fa-file-upload"></i><span id="fileCounts-').concat(t._id,'"> 0 </span>\n                  </div>\n                  <div class="col-lg-10">\n                    <div class="progress">\n                      <div id="fileProgress-').concat(t._id,'" class="progress-bar progress-bar-striped bg-warning" role="progressbar" style="width: 0%" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">\n                        0%\n                      </div>\n                    </div>\n                  </div>\n                </div>\n\n\n        \n        \n                  <small class="pt-2 float-left"\n                  ><i class="fas fa-cube"></i> <b>H:</b> ').concat(t.currentProfile.volume.height,"mm x <b>W:</b> ").concat(t.currentProfile.volume.width,"mm x <b>D:</b> ").concat(t.currentProfile.volume.depth,'mm</small\n                ><br>\x3c!--Fix for firefox--\x3e\n                <small class="pt-2 float-left"\n                  ><i class="fas fa-pen"></i> <b>Extruders:</b>\n                  ').concat(t.currentProfile.extruder.count,"\n                  <b>Nozzle Size:</b> \n                  ").concat(t.currentProfile.extruder.nozzleDiameter,"mm</small\n                >\n                \n                                ").concat(l,"\n              </div>\n            </div>\n          </a>\n              \n      "));var f=document.getElementById("fileManagerPrinter-".concat(t._id));f.addEventListener("click",(function(n){n.target.id.includes("tool")||e.changePrinter(n,t._id)})),p=n[0]._id,(0,o.dragAndDropEnable)(f,t);var m=document.getElementById("fileManagerPrinter-"+n[0]._id);m.classList.add("bg-dark"),m.classList.remove("bg-secondary"),document.getElementById("currentPrinter").innerHTML='<i class="fas fa-print"></i> '+n[0].printerName;for(var v=function(e){var n=document.getElementById("tool"+e+"-"+t._id);n.innerHTML="",r.forEach((function(e){n.insertAdjacentHTML("beforeend",e)})),Array.isArray(t.selectedFilament)&&0!==t.selectedFilament.length&&void 0!==t.selectedFilament[e]&&null!==t.selectedFilament[e]&&(n.value=t.selectedFilament[e]._id),n.addEventListener("change",function(){var n=d(regeneratorRuntime.mark((function n(r){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:(0,c.selectFilament)(t._id,r.target.value,e),setTimeout(d(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.post("printers/printerInfo",{i:p});case 2:return t=e.sent,e.next=5,t.json();case 5:t=e.sent,i.default.refreshFiles(t);case 7:case"end":return e.stop()}}),e)}))),1e3);case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())},g=0;g<t.currentProfile.extruder.count;g++)v(g)}})),l.default.loadSort(n[0]),e.updatePrinterList(n[0]._id);case 13:case"end":return t.stop()}}),t)}))),function(){return m.apply(this,arguments)})},{key:"changePrinter",value:function(t,n){if(!t.target.id.includes("filamentDrop")){document.getElementById("fileBody").innerHTML="",document.getElementById("currentFolder").innerHTML="local",document.getElementById("fileManagerPrinter-"+p).className="list-group-item list-group-item-action flex-column align-items-start bg-secondary",p=n;var a=document.getElementById("printerName-"+p).innerHTML,r=document.getElementById("fileManagerPrinter-"+n);r.classList.add("bg-dark"),r.classList.remove("bg-secondary"),document.getElementById("currentPrinter").innerHTML='<i class="fas fa-print"></i> '+a,e.updatePrinterList(n)}}},{key:"updatePrinterList",value:(u=d(regeneratorRuntime.mark((function e(t){var n,o,c,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=document.getElementById("fileBody"),(o=document.getElementById("fileManagerManagement"))&&(n=o),n.innerHTML='\n         <div class="row mb-1">\n          <div class="col-12">\n         \n\n            <label class="btn btn-success float-left mr-1 mb-0" for="fileUploadBtn"><i class="fas fa-file-import"></i> Upload File(s)</label>\n            <input id="fileUploadBtn" multiple accept=".gcode,.gco,.g" type="file" class="btn btn-success float-left" id="uploadFileBtn">\n            <label class="btn btn-info float-left mr-1 mb-0" for="fileUploadPrintBtn"><i class="fas fa-file-import"></i> Upload and Print</label>\n            <input id="fileUploadPrintBtn" accept=".gcode,.gco,.g" type="file" class="btn btn-success float-left" id="uploadFileBtn">\n\n            <button\n                    id="createFolderBtn"\n                    type="button"\n                    class="btn btn-warning float-left mr-1 mb-0"\n                    data-toggle="collapse"\n                    href="#createFolder"\n                    role="button"\n                    aria-expanded="false"\n                    aria-controls="createFolder"\n            >\n              <i class="fas fa-folder-plus"></i> Create Folder\n            </button>\n            <button id="fileReSync" type="button" class="btn btn-primary mb-0">\n              <i class="fas fa-sync"></i> Re-Sync\n            </button>\n          </div>\n\n        </div>\n        ',document.getElementById("fileBody").insertAdjacentHTML("beforeend",'\n            <div id="fileList-'.concat(t,'" class="list-group" style="max-height:100%; overflow-y:scroll; min-height:1000px;" data-jplist-group="files">\n                \n            </div>\n        ')),e.next=7,a.default.post("printers/printerInfo",{i:t});case 7:return c=e.sent,e.next=10,c.json();case 10:c=e.sent,l.default.loadSort(c),document.getElementById("backBtn").innerHTML='\n          <button id="fileBackBtn" type="button" class="btn btn-success">\n                  <i class="fas fa-chevron-left"></i> Back\n                </button>',(s={fileManager:{printerStorage:document.getElementById("printerStorage"),fileFolderCount:document.getElementById("printerFileCount"),fileSearch:document.getElementById("searchFiles"),uploadFiles:document.getElementById("fileUploadBtn"),uploadPrintFile:document.getElementById("fileUploadPrintBtn"),syncFiles:document.getElementById("fileReSync"),back:document.getElementById("fileBackBtn"),createFolderBtn:document.getElementById("createFolderBtn")}}).fileManager.fileFolderCount.innerHTML='<i class="fas fa-file"></i> '.concat(c.fileList.filecount,' <i class="fas fa-folder"></i> ').concat(c.fileList.folderCount),void 0!==c.storage?s.fileManager.printerStorage.innerHTML='<i class="fas fa-hdd"></i> '.concat(r.default.bytes(c.storage.free)," / ").concat(r.default.bytes(c.storage.total)):s.fileManager.printerStorage.innerHTML='<i class="fas fa-hdd"></i> '.concat(r.default.bytes(0)," / ").concat(r.default.bytes(0)),s.fileManager.uploadFiles.addEventListener("change",(function(){i.default.handleFiles(this.files,c)})),s.fileManager.createFolderBtn.addEventListener("click",(function(e){i.default.createFolder(c)})),s.fileManager.fileSearch.addEventListener("keyup",(function(e){i.default.search(c._id)})),s.fileManager.uploadPrintFile.addEventListener("change",(function(){i.default.handleFiles(this.files,c,"print")})),s.fileManager.back.addEventListener("click",(function(e){i.default.openFolder(void 0,void 0,c)})),s.fileManager.syncFiles.addEventListener("click",(function(e){i.default.reSyncFiles(e,c)}));case 22:case"end":return e.stop()}}),e)}))),function(e){return u.apply(this,arguments)})}],n&&f(t.prototype,n),s&&f(t,s),e}().init()},{"./lib/functions/calc.js":2,"./lib/functions/dragAndDrop.js":3,"./lib/modules/filamentGrab.js":7,"./lib/modules/fileManager.js":8,"./lib/modules/fileSorting.js":9,"./lib/octofarm.js":11}],2:[function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"randomString",value:function(){return Math.random().toString(36).substr(2,5)}},{key:"toFixed",value:function(e,t){return null!=e?e.toFixed(t):0}},{key:"generateTime",value:function(e){var t="";if(void 0===e||isNaN(e)||null===e)t="No Time Estimate";else{Math.floor(e/131400);var n=Math.floor(e/86400);e-=3600*n*24;var a=Math.floor(e/3600);e-=3600*a;var r=Math.floor(e/60);e-=60*r,e=Math.floor(e),t="".concat(n,"d, ").concat(a,"h, ").concat(r,"m, ").concat(e,"s"),0==r&&t.includes("0m")&&(t=t.replace(" 0m,","")),0==a&&t.includes("0h")&&(t=t.replace(" 0h,","")),0==n&&t.includes("0d")&&(t=t.replace("0d,","")),0==r&&0==a&&0==n&&0==e&&(t=t.replace("0s","Done"))}return t}},{key:"isBetween",value:function(e,t,n){return(e-t)*(e-n)<=0}},{key:"returnPrintCost",value:function(e,t){if(void 0===e)return"No cost settings to calculate from";var n=t/3600,a=parseFloat(e.powerConsumption)*parseFloat(e.electricityCosts)*n,r=parseFloat(e.purchasePrice),i=parseFloat(e.estimateLifespan);return(a+((i>0?r/i:0)+parseFloat(e.maintenanceCosts))*n).toFixed(2)}},{key:"bytes",value:function(e,t){if(void 0===e||isNaN(e)||null===e)return"No File Estimate";if(0==e)return"0 Bytes";var n=t||2,a=Math.floor(Math.log(e)/Math.log(1024));return"".concat(parseFloat((e/Math.pow(1024,a)).toFixed(n))," ").concat(["Bytes","KB","MB","GB","TB","PB","EB","ZB","YB"][a])}},{key:"dateClean",value:function(e){return e=new Date(e),"".concat(e.getFullYear(),"-").concat(e.getMonth(),"-").concat(e.getDay(),": ").concat(e.getHours(),":").concat(e.getSeconds())}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();n.default=r},{}],3:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.dragCheck=function(){return u.apply(this,arguments)},n.dragAndDropEnable=function(e,t){var n=document.getElementById(e.id);["dragenter","dragover","dragleave","drop"].forEach((function(e){n.addEventListener(e,d,!1),document.body.addEventListener(e,d,!1)})),["dragenter","dragover"].forEach((function(t){n.addEventListener(t,(function(t){s=!0,e.classList.add("highlight")}),!1)})),["dragleave","drop"].forEach((function(t){n.addEventListener(t,(function(t){s=!1,e.classList.remove("highlight")}),!1)})),n.addEventListener("drop",(function(e){var n;n=t,f(e.dataTransfer.files,n)}),!1)},n.handleFiles=f;var a=o(e("../modules/fileManager.js")),r=o(e("./ui.js")),i=o(e("./validate.js"));function o(e){return e&&e.__esModule?e:{default:e}}function c(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function l(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){c(i,a,r,o,l,"next",e)}function l(e){c(i,a,r,o,l,"throw",e)}o(void 0)}))}}var s=!1;function u(){return(u=l(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",s);case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(e){e.preventDefault(),e.stopPropagation()}function f(e,t){1===e.length?bootbox.confirm({message:"Would you like to print upon upload?",buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-danger"}},callback:function(n){n?(r.default.createAlert("warning","".concat(i.default.getName(t),": started upload"),3e3,"Clicked"),a.default.handleFiles(e,t,"print")):(r.default.createAlert("warning","".concat(i.default.getName(t),": started upload"),3e3,"Clicked"),a.default.handleFiles(e,t))}}):(r.default.createAlert("warning","".concat(i.default.getName(t),": started upload"),3e3,"Clicked"),a.default.handleFiles(e,t))}},{"../modules/fileManager.js":8,"./ui.js":4,"./validate.js":5}],4:[function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getColour",value:function(e){return"Operational"===e?{name:"secondary",hex:"#262626",category:"Idle"}:"Paused"===e?{name:"warning",hex:"#583c0e",category:"Idle"}:"Printing"===e||"Pausing"===e||"Cancelling"===e?{name:"warning",hex:"#583c0e",category:"Active"}:"Error"===e?{name:"danger",hex:"#2e0905",category:"Idle"}:"Offline"===e?{name:"danger",hex:"#2e0905",category:"Offline"}:"Searching..."===e?{name:"danger",hex:"#2e0905",category:"Idle"}:"Closed"===e?{name:"danger",hex:"#2e0905",category:"Closed"}:"Complete"===e?{name:"success",hex:"#00330e",category:"Complete"}:{name:"danger",hex:"#2e0905",category:"Offline"}}},{key:"createMessage",value:function(e,t){var n=document.getElementById(t),a='\n      <div class="alert alert-'.concat(e.type,' alert-dismissible fade show" role="alert">\n        ').concat(e.msg,'\n      <button type="button" class="close" data-dismiss="alert" aria-label="Close">\n        <span aria-hidden="true">&times;</span>\n      </button>\n    </div>\n    ');n.insertAdjacentHTML("beforeend",a)}},{key:"createAlert",value:function(e,t,n,a){a=null!=a?["click"]:[],Noty.setMaxVisible(50),new Noty({type:e,theme:"bootstrap-v4",closeWith:a,timeout:n,layout:"bottomRight",text:t}).show()}},{key:"doesElementNeedUpdating",value:function(e,t,n){e!==t[n]&&(t[n]=e)}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();n.default=r},{}],5:[function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"URL",value:function(e){var t;return t||(t=document.createElement("input")).setAttribute("type","url"),t.value=e,t.validity.valid}},{key:"IP",value:function(e){return!!/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e)}},{key:"JSON",value:function(e){return!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}},{key:"getName",value:function(e){return void 0!==e.settingsAppearance?""===e.settingsAppearance.name||null===e.settingsAppearance.name?e.printerURL:e.settingsAppearance.name:e.printerURL}},{key:"stripHTML",value:function(e){var t=document.createElement("DIV");t.innerHTML=e;var n=t.textContent||t.innerText||"";return n.replace("â€‹",""),n=n.trim()}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();n.default=r},{}],6:[function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.data=[]}var t,n,r;return t=e,(n=[{key:"add",value:function(e){e.active=!1,this.data.push(e)}},{key:"remove",value:function(){this.data.shift()}},{key:"first",value:function(){return this.data[0]}},{key:"activate",value:function(e){this.data[e].active=!0}},{key:"size",value:function(){return this.data.length}},{key:"all",value:function(){var e=this,t=[];return this.data.forEach((function(n,a){t.push(e.data[a])})),t}}])&&a(t.prototype,n),r&&a(t,r),e}();n.default=r},{}],7:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.checkFilamentManager=function(){return c.apply(this,arguments)},n.returnDropDown=function(e){return l.apply(this,arguments)},n.selectFilament=function(e,t,n){return s.apply(this,arguments)};var a,r=(a=e("../octofarm.js"))&&a.__esModule?a:{default:a};function i(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function o(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var o=e.apply(t,n);function c(e){i(o,a,r,c,l,"next",e)}function l(e){i(o,a,r,c,l,"throw",e)}c(void 0)}))}}function c(){return(c=o(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.default.get("settings/server/get");case 2:return t=e.sent,e.next=5,t.json();case 5:return t=e.sent,e.abrupt("return",t.filamentManager);case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function l(){return(l=o(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.default.get("filament/get/dropDownList");case 2:return n=e.sent,e.next=5,n.json();case 5:if(n=e.sent,!t){e.next=10;break}return e.abrupt("return",n.selected.historyDropDown);case 10:return e.abrupt("return",n.selected.normalDropDown);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function s(){return(s=o(regeneratorRuntime.mark((function e(t,n,a){var i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={tool:a,printerId:t,spoolId:n},e.next=3,r.default.post("filament/select",i);case 3:e.sent;case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},{"../octofarm.js":11}],8:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.FileActions=n.default=void 0;var a=d(e("../octofarm.js")),r=d(e("../octoprint.js")),i=d(e("./clientQueue.js")),o=d(e("../functions/calc.js")),c=d(e("../functions/ui.js")),l=e("../functions/dragAndDrop.js"),s=d(e("./fileSorting.js")),u=d(e("./printerSelect.js"));function d(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(e){if(Array.isArray(e))return p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,a=new Array(t);n<t;n++)a[n]=e[n];return a}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function g(e,t,n){return t&&v(e.prototype,t),n&&v(e,n),e}function y(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function b(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function o(e){y(i,a,r,o,c,"next",e)}function c(e){y(i,a,r,o,c,"throw",e)}o(void 0)}))}}var h=new i.default;setInterval(b(regeneratorRuntime.mark((function e(){var t,n,r,i,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(h.size()>0)){e.next=20;break}if((t=h.first()).active){e.next=20;break}return h.activate(0),n=new Date,e.next=7,t.upload(t);case 7:return r=e.sent,(r=JSON.parse(r)).index=t.index,r.uploadDate=n.getTime()/1e3,e.next=13,a.default.post("printers/newFiles",r);case 13:return e.sent,e.next=16,x.drawFile(r);case 16:e.sent,h.remove(),(i=document.getElementById("fileCounts-".concat(t.index)))&&1==i.innerHTML&&(i.innerHTML=" ".concat(0));case 20:(o=h.all()).forEach((function(e){var t=o.reduce((function(t,n){return t+(n.index==e.index)}),0),n=document.getElementById("fileCounts-".concat(e.index));n&&(n.innerHTML=" ".concat(t))}));case 22:case"end":return e.stop()}}),e)}))),1e3);var x=function(){function e(){m(this,e)}var t,n,r,i,d,p;return g(e,null,[{key:"handleFiles",value:(p=b(regeneratorRuntime.mark((function t(n,a,r){var i,o,c,l;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(n=f(n),i=0;i<n.length;i++)o={},(c=document.getElementById("fileUploadCountSpinner"))&&(c.classList.contains("fa-spin")||(c.classList="fas fa-spinner fa-spin")),o.file=n[i],void 0!==r&&(o.print=!0),o.index=a._id,o.printerInfo=a,l=document.getElementById("currentFolder"),o.currentFolder=l?l.innerHTML:"local/",o.upload=e.fileUpload,h.add(o);case 2:case"end":return t.stop()}}),t)}))),function(e,t,n){return p.apply(this,arguments)})},{key:"createUpload",value:function(e,t,n,a){var r=h.size(),i=document.getElementById("fileUploadCount");if(i&&(i.innerHTML="File Queue: ".concat(r),r<1)){i.innerHTML="File Queue: 0";var o=document.getElementById("fileUploadCountSpinner");o.classList.contains("fa-spin")&&(o.classList="fas fa-spinner")}var c=document.getElementById("fileProgress-".concat(e));if(c){c.classList="progress-bar progress-bar-striped bg-warning";var l=n/a*100;isNaN(l)&&(l=0),c.innerHTML="".concat(Math.floor(l),"%"),c.style.width="".concat(l,"%"),100==l&&(c.classList="progress-bar progress-bar-striped bg-success")}}},{key:"fileUpload",value:function(t){return new Promise((function(n,r){var i=t.currentFolder,o=t.index,l=t.printerInfo,s=new FormData,u="";i.includes("local/")&&(u=i.replace("local/","")),s.append("file",t.file),s.append("path",u),t.print&&s.append("print",!0);var d="".concat(l.printerURL,"/api/files/local"),f=new XMLHttpRequest;t=t.file,f.open("POST",d),f.upload.onprogress=function(n){n.lengthComputable&&e.createUpload(l._id,t.name,n.loaded,n.total)},f.setRequestHeader("X-Api-Key",l.apikey),f.onloadstart=function(n){e.createUpload(l._id,t.name,n.loaded,n.total)},f.onloadend=function(){var r=b(regeneratorRuntime.mark((function r(i){var s,u;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:s='<i class="fas fa-spinner fa-pulse"></i> Checking Octoprint for information... <br>',e.createUpload(l._id,t.name,i.loaded,i.total),setTimeout((function(){e.createUpload(l._id,t.name,i.loaded,i.total)}),5e3),this.status>=200&&this.status<300?(n(f.response),c.default.createAlert("success","".concat(t.name," has finished uploading to Printer: ").concat(l.printerName),3e3,"clicked"),setTimeout(b(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.default.post("printers/printerInfo",{i:l._id});case 2:return n=t.sent,t.next=5,n.json();case 5:n=t.sent,e.refreshFiles(n,s),setTimeout(b(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.default.post("printers/printerInfo",{i:l._id});case 2:return n=t.sent,t.next=5,n.json();case 5:n=t.sent,e.refreshFiles(n,s),setTimeout(b(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,a.default.post("printers/printerInfo",{i:l._id});case 2:return n=t.sent,t.next=5,n.json();case 5:n=t.sent,e.refreshFiles(n,"");case 7:case"end":return t.stop()}}),t)}))),5e3);case 8:case"end":return t.stop()}}),t)}))),5e3);case 8:case"end":return t.stop()}}),t)}))),5500)):(h.remove(),(u=document.getElementById("fileCounts-".concat(o)))&&1==u.innerHTML&&(u.innerHTML=" ".concat(0)),n(f.response),c.default.createAlert("error","Sorry but ".concat(t.name," could not be uploaded... is CORS enabled and OctoPrint online?"),3e3,"clicked"));case 4:case"end":return r.stop()}}),r,this)})));return function(e){return r.apply(this,arguments)}}(),f.onerror=function(){n(f.response),c.default.createAlert("error","Sorry but ".concat(t.name," could not be uploaded... is CORS enabled and OctoPrint online?"),3e3,"")},t.name.includes(".gcode")?f.send(s):c.default.createAlert("error","Sorry but ".concat(t.name," is not a gcode file, could not be uploading."),3e3,"")}))}},{key:"actionBtnGate",value:function(e,t){var n=t.split("*"),a=n[1],r=n[2];"fileActionStart"===a?k.startPrint(e,r):"fileActionSelect"===a?k.selectFile(e,r):"fileActionUpdate"===a?k.updateFile(e,t,r):"fileActionMove"===a?k.moveFile(e,r):"fileActionDownload"===a||("fileActionDelete"===a?k.deleteFile(e,r):"folderActionMove"===a?k.moveFolder(e,r):"folderActionDelete"===a&&k.deleteFolder(e,r))}},{key:"reSyncFiles",value:(d=b(regeneratorRuntime.mark((function t(n,r){var i,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n.target.innerHTML="<i class='fas fa-sync fa-spin'></i> Re-Syncing...",t.next=3,a.default.post("printers/resyncFile",{i:r._id});case 3:return i=t.sent,t.next=6,i.json();case 6:t.sent,o=function(){n.target.classList="btn btn-primary mb-0",n.target.innerHTML="<i class='fas fa-sync'></i> Re-Sync"},n.target.classList="btn btn-primary mb-0",n.target.innerHTML="<i class='fas fa-sync'></i> Re-Sync",setTimeout(o,500),e.updateFileList(r._id);case 10:case"end":return t.stop()}}),t)}))),function(e,t){return d.apply(this,arguments)})},{key:"updateFileList",value:(i=b(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.post("printers/printerInfo",{i:t});case 2:return n=e.sent,e.next=5,n.json();case 5:return n=e.sent,s.default.loadSort(n),e.abrupt("return","done");case 8:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"openFolder",value:function(t,n,a){if(void 0===n||"button"!==n.type)if(void 0!==t)t=t.replace("file-",""),document.getElementById("currentFolder").innerHTML="local/".concat(t),e.updateFileList(a._id);else{var r=document.getElementById("currentFolder").innerHTML;if("local"!=r){var i=r.substring(0,r.lastIndexOf("/"));document.getElementById("currentFolder").innerHTML=i,e.updateFileList(a._id)}}}},{key:"drawFile",value:(r=b(regeneratorRuntime.mark((function t(n){var r,i,o,c,l,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,r=document.getElementById("fileList-".concat(n.index)),i=new Date(1e3*n.uploadDate),o=i.toDateString(),c=i.toTimeString().substring(0,8),i="".concat(o," ").concat(c),l=' <div\n            id="file-'.concat(n.files.local.path,'"\n            href="#"\n          class="list-group-item list-group-item-action flex-column align-items-start bg-secondary"\n            style="display: block;\n            padding: 0.7rem 0.1rem;"\n            >\n            <div class="row">\n                <div\n                id="fileThumbnail-').concat(n.files.local.path,'"\n          class="col-lg-2"\n            style="display:flex; justify-content:center; align-items:center;"\n                >\n                <center><i class="fas fa-file-code fa-2x"></i></center>\n                </div>\n                <div class="col-lg-10">\n                <div class="row">\n                <div class="col-12">\n                <h5 class="mb-1 name">').concat(n.files.local.name.replace("/_/g"," "),'</h5>         \n                </div>\n                </div>\n                <div class="row">\n                <div class="col-12">\n                <p class="mb-1 float-right">\n                  <span title="File specific success / failure rate from OctoPrint" id="fileHistoryRate-').concat(n.files.local.path,'"><i class="fas fa-thumbs-up"></i> <i class="fa fa-spinner fa-spin" aria-hidden="true"></i> / <i class="fas fa-thumbs-down"></i> <i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span><br>\n                <i class="fas fa-stopwatch"></i> \n                <span class="time" id="fileTime-').concat(n.files.local.path,'">\n                <i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span> <br> \n                <i class="fas fa-dollar-sign"></i> \n                <span title="Expected Printer Cost" class="cost" id="fileCost-').concat(n.files.local.path,'">  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span>  </span>    <br> \n            <span title="Expected Filament Cost" > </span>\n\n                </p>\n                <p class="mb-1 float-left">\n                <i class="fas fa-clock"></i><span id="fileDateClean-').concat(n.files.local.path,'" class="date d-none"> ').concat(n.uploadDate,'</span><span id="fileDate-').concat(n.files.local.path,'"> ').concat(i,'</span><br>\n                <i class="fas fa-hdd"></i><span class="size" id="fileSize-').concat(n.files.local.path,'">  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span> </span> <br>\n            <span class="usage" title="Expected Filament Usage/Cost" id="fileTool-').concat(n.files.local.path,'">  <i class="fa fa-spinner fa-spin" aria-hidden="true"></i></span>  </span>\n                </p> \n                </div>\n                </div>\n                </div>\n                <div class="col-lg-12">\n                <div\n          class="d-flex btn-group flex-wrap btn-group-sm"\n            role="group"\n            aria-label="Basic example"\n                >\n                <button\n            title="Re-Sync File"\n            id="').concat(n.index,"*fileActionUpdate*").concat(n.files.local.path,'"\n            role="button"\n          class="btn btn-dark"\n                >\n                <i class="fas fa-sync"></i> Re-Sync\n                </button>\n                <button           title="Start printing file"\n            id="').concat(n.index,"*fileActionStart*").concat(n.files.local.path,'" type="button" class="btn btn-success">\n          <i class="fas fa-play"></i> Start\n              </button>\n              <button  title="Select file" id="').concat(n.index,"*fileActionSelect*").concat(n.files.local.path,'" type="button" class="btn btn-info">\n        <i class="fas fa-file-upload"></i> Select\n            </button>\n            <button          title="Move file" id="').concat(n.index,"*fileActionMove*").concat(n.files.local.path,'" type="button" class="btn btn-warning">\n      <i class="fas fa-people-carry"></i> Move\n          </button>\n          <button          title="Download file" onclick="window.open(\'').concat(n.files.local.refs.download,'\')" type="button" class="btn btn-dark">\n    <i class="fas fa-download"></i> Download\n        </button>\n        <button title="Delete file" id="').concat(n.index,"*fileActionDelete*").concat(n.files.local.path,'" type="button" class="btn btn-danger">\n  <i class="fas fa-trash-alt"></i> Delete\n      </button>\n      </div>\n      </div>\n      </div>\n      </div>\n      </div>'),r.insertAdjacentHTML("afterbegin",l),t.next=10,a.default.post("printers/printerInfo",{i:n.index});case 10:return s=t.sent,t.next=13,s.json();case 13:s=t.sent,document.querySelectorAll("[id*='*fileAction']").forEach((function(t){t.id.includes(s._id)&&t.addEventListener("click",function(){var n=b(regeneratorRuntime.mark((function n(a){return regeneratorRuntime.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e.actionBtnGate(s,t.id);case 1:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())})),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(0),console.log(t.t0);case 21:case"end":return t.stop()}}),t,null,[[0,18]])}))),function(e){return r.apply(this,arguments)})},{key:"refreshFiles",value:(n=b(regeneratorRuntime.mark((function e(t,n){var a,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a=function(e){var a=t.fileList.fileList[e],r=document.getElementById("currentFolder").innerHTML;if(r.includes("local/")&&(r=r.replace("local/","")),a.path===r&&document.getElementById("file-".concat(a.fullPath))){var i="";a.toolUnits.forEach((function(e,t){i+='<i class="fas fa-weight"></i> '.concat(e,' / <i class="fas fa-dollar-sign"></i> Cost: ').concat(a.toolCosts[t],"<br>")}));var c='<center><i class="fas fa-file-code fa-2x"></i></center>';void 0!==a.thumbnail&&null!==a.thumbnail&&(c="<center><img src='".concat(t.printerURL,"/").concat(a.thumbnail,'\' width="100%"></center>'));var l=new Date(1e3*a.uploadDate),s=l.toDateString(),u=l.toTimeString().substring(0,8);l="".concat(s," ").concat(u),document.getElementById("fileHistoryRate-"+a.fullPath).innerHTML=n+'<i class="fas fa-thumbs-up"></i> 0 / <i class="fas fa-thumbs-down"></i> 0',document.getElementById("fileDate-".concat(a.fullPath)).innerHTML=" ".concat(l),document.getElementById("fileSize-".concat(a.fullPath)).innerHTML=" ".concat(o.default.bytes(a.fileSize)),document.getElementById("fileTool-".concat(a.fullPath)).innerHTML=" ".concat(i),document.getElementById("fileTime-".concat(a.fullPath)).innerHTML=" ".concat(o.default.generateTime(a.expectedPrintTime)),document.getElementById("fileCost-".concat(a.fullPath)).innerHTML=" "+"Print Cost: ".concat(a.printCost),document.getElementById("fileThumbnail-".concat(a.fullPath)).innerHTML=" ".concat(c),document.getElementById("fileDateClean-".concat(a.fullPath)).innerHTML=a.uploadDate}},r=0;r<t.fileList.fileList.length;r++)a(r);case 2:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"drawFiles",value:function(t,n){try{var a=document.getElementById("fileList-".concat(t._id));if(a){var r=t.fileList;if("danger"===t.systemChecks.cleaning.file.status)a.innerHTML='\n            <div class="noStorage  text-center"><i class="fas fa-file-code fa-5x"></i><br><h5>There are no files in local storage...</h5></div>\n      ';else{a.innerHTML="";var i=document.getElementById("currentFolder").innerHTML;i.includes("local/")&&(i=i.replace("local/","")),r.folderList.length>0&&r.folderList.forEach((function(e){e.path==i&&a.insertAdjacentHTML("beforeend",'<a\n              id="file-'.concat(e.name,'"\n              href="#"\n              class="list-group-item list-group-item-action flex-column align-items-start bg-dark folderAction"\n              style="display: block;\n                padding: 0.7rem 0.1rem;"\n            >\n              <div class="row">\n                <div\n                  class="col-lg-1"\n                  style="display:flex; justify-content:center; align-items:center;"\n                >\n                  <center><i class="fas fa-folder fa-2x"></i></center>\n                </div>\n                <div class="col-lg-11">\n                  <small class="float-right"\n                    >\x3c!--Display file and folder count here eventually--\x3e</small\n                  >\n                  <div class="d-flex w-100 justify-content-between">\n                    <h5 class="mb-1 float-left">\n                      ').concat(e.display,'\n                    </h5>\n                    <div\n                      class="float-right btn-group flex-wrap btn-group-sm"\n                      role="group"\n                      aria-label="Basic example"\n                    >\n                      <button id="').concat(t._id,"*folderActionMove*").concat(e.name,'" type="button" class="btn btn-warning">\n                        <i class="fas fa-people-carry"></i> Move\n                      </button>\n                      <button id="').concat(t._id,"*folderActionDelete*").concat(e.name,'" type="button" class="btn btn-danger">\n                        <i class="fas fa-trash-alt"></i> Delete\n                      </button>\n                    </div>\n                  </div>\n                </div>\n              </div>\n            </a>\n         \n            '))})),r.fileList.length>0&&r.fileList.forEach((function(e){var r="";e.toolUnits.forEach((function(t,n){r+='<i class="fas fa-weight"></i> '.concat(t,' / <i class="fas fa-dollar-sign"></i> Cost: ').concat(e.toolCosts[n],"<br>")}));var c='<center><i class="fas fa-file-code fa-2x"></i></center>';void 0!==e.thumbnail&&null!==e.thumbnail&&(c="<center><img src='".concat(t.printerURL,"/").concat(e.thumbnail,'\' width="100%"></center>'));var l=new Date(1e3*e.uploadDate),s=l.toDateString(),u=l.toTimeString().substring(0,8),d="bg-secondary";!0===e.last?d="bg-dark-success":!1===e.last&&(d="bg-dark-failed"),l="".concat(s," ").concat(u);var f=' <div\n            id="file-'.concat(e.fullPath,'"\n            href="#"\n          class="list-group-item list-group-item-action flex-column align-items-start ').concat(d,'"\n            style="display: block;\n            padding: 0.7rem 0.1rem;"\n            >\n            <div class="row">\n                <div\n                            id="fileThumbnail-').concat(e.fullPath,'"\n          class="col-lg-2"\n            style="display:flex; justify-content:center; align-items:center;"\n                >\n                ').concat(c,'\n                </div>\n                <div class="col-lg-10">\n                <div class="row">\n                <div class="col-12">\n                <h5 class="mb-1 name">').concat(e.display,'</h5>         \n                </div>\n                </div>\n                <div class="row">\n                <div class="col-12">\n                <p class="mb-1 float-right">\n                <span title="File specific success / failure rate from OctoPrint" id="fileHistoryRate-').concat(e.fullPath,'"><i class="fas fa-thumbs-up"></i> ').concat(e.success,' / <i class="fas fa-thumbs-down"></i> ').concat(e.failed,'</span><br>\n                <i class="fas fa-stopwatch"></i> \n                <span class="time" id="fileTime-').concat(e.fullPath,'">\n                    ').concat(o.default.generateTime(e.expectedPrintTime),'</span> <br> \n                <i class="fas fa-dollar-sign"></i> \n                <span title="Expected Printer Cost" class="cost" id="fileCost-').concat(e.fullPath,'"> Print Cost: ').concat(e.printCost,' </span>    <br> \n            <span title="Expected Filament Cost"> </span>\n\n                </p>\n                <p class="mb-1 float-left">\n                <i class="fas fa-clock"></i><span id="fileDateClean-').concat(e.fullPath,'" class="date d-none"> ').concat(e.uploadDate,'</span><span id="fileDate-').concat(e.fullPath,'"> ').concat(l,'</span><br>\n                <i class="fas fa-hdd"></i><span class="size" id="fileSize-').concat(e.fullPath,'"> ').concat(o.default.bytes(e.fileSize),'</span> <br>\n            <span class="usage" title="Expected Filament Usage/Cost" id="fileTool-').concat(e.fullPath,'"> ').concat(r,' </span>\n\n                </p> \n                </div>\n                </div>\n                </div>\n                <div class="col-lg-12">\n                <div\n          class="d-flex btn-group flex-wrap btn-group-sm"\n            role="group"\n            aria-label="Basic example"\n                >\n                <button\n            title="Re-Sync File"\n            id="').concat(t._id,"*fileActionUpdate*").concat(e.fullPath,'"\n            role="button"\n          class="btn btn-dark"\n                >\n                <i class="fas fa-sync"></i> Re-Sync\n                </button>\n                <button           title="Start printing file"\n            id="').concat(t._id,"*fileActionStart*").concat(e.fullPath,'" type="button" class="btn btn-success">\n          <i class="fas fa-play"></i> Start\n              </button>\n              <button  title="Select file" id="').concat(t._id,"*fileActionSelect*").concat(e.fullPath,'" type="button" class="btn btn-info">\n        <i class="fas fa-file-upload"></i> Select\n            </button>\n            <button          title="Move file" id="').concat(t._id,"*fileActionMove*").concat(e.fullPath,'" type="button" class="btn btn-warning">\n      <i class="fas fa-people-carry"></i> Move\n          </button>\n          <button          title="Download file" onclick="window.open(\'').concat(t.printerURL,"/downloads/files/local/").concat(e.fullPath,'\')" type="button" class="btn btn-dark">\n    <i class="fas fa-download"></i> Download\n        </button>\n        <button title="Delete file" id="').concat(t.printerURL,"*fileActionDelete*").concat(e.fullPath,'" type="button" class="btn btn-danger">\n  <i class="fas fa-trash-alt"></i> Delete\n      </button>\n      </div>\n      </div>\n      </div>\n      </div>\n      </div>');(void 0!==n||e.path==i)&&a.insertAdjacentHTML("beforeend",f)})),e.updateListeners(t)}}}catch(e){console.log(e)}}},{key:"search",value:function(e){k.search(e)}},{key:"createFolder",value:function(e){k.createFolder(e)}},{key:"updateListeners",value:function(t){var n=document.getElementById("fileList-".concat(t._id));(0,l.dragAndDropEnable)(n,t),document.querySelectorAll(".folderAction").forEach((function(n){n.addEventListener("click",(function(a){e.openFolder(n.id,a.target,t)}))})),document.querySelectorAll("[id*='*fileAction']").forEach((function(n){n.addEventListener("click",(function(a){e.actionBtnGate(t,n.id)}))})),document.querySelectorAll("[id*='*folderAction']").forEach((function(n){n.addEventListener("click",(function(a){e.actionBtnGate(t,n.id)}))}))}},{key:"multiUpload",value:(t=b(regeneratorRuntime.mark((function t(){var n,r,i,o,l,s,d,p;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:p=function(e){e=f(e),o=e;var t=document.getElementById("multiFileSelectedNow");t.innerHTML="",o.forEach((function(e){t.insertAdjacentHTML("beforeend","\n          <li>".concat(e.name,"</li>\n        "))}))},d=function(){""==r&&(r="local"),n.forEach((function(t){var n=document.getElementById("fileUploadCountSpinner");n.classList.contains("fa-spin")||(n.classList="fas fa-spinner fa-spin"),o.forEach((function(n){var a={},o=t.value;a.file=n,a.index=o,a.printerInfo=t.printerInfo,a.upload=e.fileUpload,a.currentFolder=r,i&&(a.print=!0),h.add(a)}))}))},s=function(){return(s=b(regeneratorRuntime.mark((function e(){var t,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=document.querySelectorAll('*[id^="multiUpPrinters-"]'),!((n=[].filter.call(t,(function(e){return e.checked}))).length<2)){e.next=5;break}return c.default.createAlert("error","Please select MORE than ".concat(n.length," printer(s)!"),2e3,"clicked"),e.abrupt("return");case 5:return document.getElementById("multiPrinterBtn").disabled=!0,document.getElementById("multiFolder").disabled=!1,document.getElementById("multiPrintersSection").classList.add("hidden"),document.getElementById("multiFolderSection").classList.remove("hidden"),document.getElementById("multiUploadFooter").innerHTML='<button id="multiUpSubmitBtn" type="button" class="btn btn-warning float-right">Next</button>',document.getElementById("multiUpSubmitBtn").addEventListener("click",(function(e){l()})),document.getElementById("multiSelectedPrinters2").innerHTML="",e.next=14,a.default.post("printers/printerInfo",{i:null});case 14:return o=e.sent,e.next=17,o.json();case 17:o=e.sent,n.forEach((function(e,t){if(e){var a=_.findIndex(o,(function(t){return t._id==e.value.toString()})),r="";r=void 0!==o[a].settingsAppearance?""===o[a].settingsAppearance.name||null===o[a].settingsAppearance.name?o[a].printerURL:o[a].settingsAppearance.name:o[a].printerURL,document.getElementById("multiSelectedPrinters2").insertAdjacentHTML("beforeend",'\n            [<span class="MultiSelected">'.concat(r,"</span>]\n            ")),n[t]={value:o[a]._id,printerInfo:o[a]}}})),document.getElementById("multiFolder").disabled=!0,document.getElementById("multiFile").disabled=!1,document.getElementById("multiFileSection").classList.remove("hidden"),document.getElementById("multiFolderSection").classList.add("hidden"),document.getElementById("multiUploadFooter").innerHTML='<button id="multiUpSubmitBtn" type="button" class="btn btn-success float-right" data-dismiss="modal">Start!</button>',document.getElementById("multiUpSubmitBtn").addEventListener("click",(function(e){d()})),""!=(r=document.getElementById("multiNewFolder").value)&&(r+=""),document.getElementById("printOnLoadBtn").addEventListener("click",(function(e){var t;t=e.target.checked;var n=document.getElementById("multiFileUploadBtn"),a=document.getElementById("multiFileUploadBtnLabel");t?(n.removeAttribute("multiple",""),n.setAttribute("single",""),a.innerHTML='<i class="fas fa-file-import"></i> Upload File',i=!0):(n.setAttribute("multiple",""),n.removeAttribute("single",""),a.innerHTML='<i class="fas fa-file-import"></i> Upload Files',i=!1)})),document.getElementById("multiFileUploadBtn").addEventListener("change",(function(){p(this.files)}));case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)},l=function(){return s.apply(this,arguments)},n=null,r="",i=!1,o=null,u.default.create(document.getElementById("multiPrintersSection")),document.getElementById("multiFileSelectedNow").innerHTML="",document.getElementById("multiPrinterBtn").disabled=!1,document.getElementById("multiFolder").disabled=!0,document.getElementById("multiFile").disabled=!0,document.getElementById("multiPrintersSection").classList.remove("hidden"),document.getElementById("multiFolderSection").classList.add("hidden"),document.getElementById("multiFileSection").classList.add("hidden"),document.getElementById("multiUploadFooter").innerHTML='<button id="multiUpSubmitBtn" type="button" class="btn btn-warning float-right">Next</button>',document.getElementById("multiUpSubmitBtn").addEventListener("click",(function(e){l()}));case 20:case"end":return t.stop()}}),t)}))),function(){return t.apply(this,arguments)})}]),e}();n.default=x;var k=function(){function e(){m(this,e)}var t,n,i,o;return g(e,null,[{key:"search",value:(o=b(regeneratorRuntime.mark((function e(t){var n,r,i,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,a.default.post("printers/printerInfo",{i:t});case 2:return n=e.sent,e.next=5,n.json();case 5:for(n=e.sent,r=document.getElementById("fileList-".concat(t)),(i=(i=document.getElementById("searchFiles").value.toUpperCase()).replace(/ /g,"_")).value,document.getElementById("currentFolder").value="local",s.default.loadSort(n),o=r.querySelectorAll('*[id^="file-"]'),c=0;c<o.length;c++)o[c].id.replace("file-","").toUpperCase().indexOf(i)>-1?o[c].style.display="":o[c].style.display="none";case 12:case"end":return e.stop()}}),e)}))),function(e){return o.apply(this,arguments)})},{key:"createFolder",value:(i=b(regeneratorRuntime.mark((function e(t){var n,i;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=document.getElementById("currentFolder").innerHTML,i=new FormData,"local"===n?n="":n.includes("local/")&&(n=n.replace("local/","")),bootbox.prompt("What would you like to name your folder?",function(){var e=b(regeneratorRuntime.mark((function e(o){var l,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!o){e.next=16;break}return i.append("foldername",o),i.append("path","".concat(n,"/")),e.next=5,r.default.folder(t,"local",i);case 5:if(201!==(l=e.sent).status&&200!==l.status){e.next=15;break}return s={i:t._id,foldername:o,path:n},e.next=10,a.default.post("printers/newFolder",s);case 10:e.sent,c.default.createAlert("success","Successfully created your new folder...",3e3,"clicked"),x.updateFileList(t._id),e.next=16;break;case 15:c.default.createAlert("error","Sorry your folder couldn't be saved...",3e3,"clicked");case 16:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 4:case"end":return e.stop()}}),e)}))),function(e){return i.apply(this,arguments)})},{key:"grabUsage",value:function(e){if(void 0===e.length)return null===e.length||e.length.length,"No Length";var t={totalLength:[],totalGrams:[],usage:[]};return e.length.forEach((function(e){var n=parseFloat(1.75)/2,a=e/1e3*Math.PI*n*n*parseFloat(1.24);t.totalLength.push(e/1e3),t.totalGrams.push(a),t.usage.push("".concat((e/1e3).toFixed(2),"m / ").concat(a.toFixed(2),"g"))})),t.totalLength=t.totalLength.reduce((function(e,t){return e+t}),0),t.totalGrams=t.totalGrams.reduce((function(e,t){return e+t}),0),t}},{key:"startPrint",value:(n=b(regeneratorRuntime.mark((function e(t,n){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.default.file(t,n,"print");case 1:case"end":return e.stop()}}),e)}))),function(e,t){return n.apply(this,arguments)})},{key:"selectFile",value:function(e,t){r.default.file(e,t,"load")}},{key:"updateFile",value:(t=b(regeneratorRuntime.mark((function e(t,n,r){var i,o,c,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(i=document.getElementById(n)).innerHTML='<i class="fas fa-sync fa-spin"></i> Refreshing...',e.next=5,a.default.post("printers/resyncFile",{i:t._id,fullPath:r});case 5:return o=e.sent,e.next=8,o.json();case 8:c=e.sent,x.updateFileList(t._id),i.innerHTML='<i class="fas fa-sync"></i> Refresh',l=function(){i.classList="btn btn-dark"},c?(i.classList="btn btn-sm btn-success",setTimeout(l,500)):(i.classList="btn btn-sm btn-danger",setTimeout(l,500));case 13:case"end":return e.stop()}}),e)}))),function(e,n,a){return t.apply(this,arguments)})},{key:"moveFile",value:function(e,t){var n=[];n.push({text:"local",value:"/"}),e.fileList.folderList.forEach((function(e){var t={text:e.name,value:e.name};n.push(t)})),bootbox.prompt({title:"Where would you like to move the file?",inputType:"select",inputOptions:n,callback:function(n){return b(regeneratorRuntime.mark((function i(){var o,l,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!n){i.next=22;break}return o={command:"move",destination:n},i.next=4,r.default.post(e,"files/local/".concat(t),o);case 4:if(404!==(l=i.sent).status){i.next=9;break}c.default.createAlert("error","We could not find the location, does it exist?",3e3,"clicked"),i.next=22;break;case 9:if(409!==l.status){i.next=13;break}c.default.createAlert("error","There was a conflict, file already exists or is in use...",3e3,"clicked"),i.next=22;break;case 13:return i.next=15,l.json();case 15:return s=i.sent,u={index:e._id,newPath:n,fileName:s.name,newFullPath:s.path},c.default.createAlert("warning","Moving file... please wait.",3e3,"clicked"),i.next=20,a.default.post("printers/moveFile",u);case 20:i.sent,setTimeout((function(){x.updateFileList(e._id),c.default.createAlert("success","Successfully moved your file...",3e3,"clicked")}),3e3);case 22:case"end":return i.stop()}}),i)})))()}})}},{key:"deleteFile",value:function(e,t){bootbox.confirm({message:"Are you sure you want to delete ".concat(t,"?"),buttons:{cancel:{label:'<i class="fa fa-times"></i> Cancel'},confirm:{label:'<i class="fa fa-check"></i> Confirm'}},callback:function(n){return b(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!n){a.next=3;break}return a.next=3,r.default.file(e,t,"delete");case 3:case"end":return a.stop()}}),a)})))()}})}},{key:"deleteFolder",value:function(e,t){bootbox.confirm({message:"Are you sure you want to delete ".concat(t,"?"),buttons:{cancel:{label:'<i class="fa fa-times"></i> Cancel'},confirm:{label:'<i class="fa fa-check"></i> Confirm'}},callback:function(n){return b(regeneratorRuntime.mark((function i(){var o;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(o={index:e._id,fullPath:t},!n){i.next=8;break}return i.next=4,r.default.delete(e,"files/local/".concat(t));case 4:return i.sent,i.next=7,a.default.post("printers/removefolder",o);case 7:i.sent;case 8:case"end":return i.stop()}}),i)})))()}})}},{key:"moveFolder",value:function(e,t){var n=[];n.push({text:"local",value:"/"}),e.fileList.folderList.forEach((function(e){var t={text:e.name,value:e.name};n.push(t)})),bootbox.prompt({title:"Where would you like to move the file?",inputType:"select",inputOptions:n,callback:function(n){return b(regeneratorRuntime.mark((function i(){var o,l,s,u;return regeneratorRuntime.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(!n){i.next=22;break}return o={command:"move",destination:n},i.next=4,r.default.post(e,"files/local/".concat(t),o);case 4:if(404!==(l=i.sent).status){i.next=9;break}c.default.createAlert("error","We could not find the location, does it exist?",3e3,"clicked"),i.next=22;break;case 9:if(409!==l.status){i.next=13;break}c.default.createAlert("error","There was a conflict, file already exists or is in use...",3e3,"clicked"),i.next=22;break;case 13:return i.next=15,l.json();case 15:return s=i.sent,u={index:e._id,oldFolder:t,newFullPath:n,folderName:s.path},c.default.createAlert("warning","Moving folder please wait...",3e3,"clicked"),i.next=20,a.default.post("printers/moveFolder",u);case 20:i.sent,setTimeout((function(){x.updateFileList(e._id),c.default.createAlert("success","Successfully moved your file...",3e3,"clicked")}),3e3);case 22:case"end":return i.stop()}}),i)})))()}})}}]),e}();n.FileActions=k},{"../functions/calc.js":2,"../functions/dragAndDrop.js":3,"../functions/ui.js":4,"../octofarm.js":11,"../octoprint.js":12,"./clientQueue.js":6,"./fileSorting.js":9,"./printerSelect.js":10}],9:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,r=(a=e("./fileManager.js"))&&a.__esModule?a:{default:a};function i(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,a=[{key:"saveSort",value:function(e,t){localStorage.setItem("fileSort",JSON.stringify({meta:e,reverse:t}))}},{key:"loadSort",value:function(e){var t=JSON.parse(localStorage.getItem("fileSort"));if(null!==t){var n=t.reverse;"file"===t.meta&&this.sortFileName(e,n),"date"===t.meta&&this.sortUploadDate(e,n),"time"===t.meta&&this.sortPrintTime(e,n)}else this.sortUploadDate(e,!0);this.setListeners(e)}},{key:"setListeners",value:function(e){var t=this;document.getElementById("sortFileNameUp").addEventListener("click",(function(n){t.sortFileName(e,!0)})),document.getElementById("sortFileNameDown").addEventListener("click",(function(n){t.sortFileName(e)})),document.getElementById("sortPrintTimeUp").addEventListener("click",(function(n){t.sortPrintTime(e,!0)})),document.getElementById("sortPrintTimeDown").addEventListener("click",(function(n){t.sortPrintTime(e)})),document.getElementById("sortDateUp").addEventListener("click",(function(n){t.sortUploadDate(e)})),document.getElementById("sortDateDown").addEventListener("click",(function(n){t.sortUploadDate(e,!0)}))}},{key:"sortFileName",value:function(e,t){var n=document.getElementById("fileSortDropdownMenu");e.fileList.fileList=_.sortBy(e.fileList.fileList,[function(e){return e.display}]),t?(e.fileList.fileList=e.fileList.fileList.reverse(),n.innerHTML='<i class="fas fa-sort-alpha-up"></i> File Name',this.saveSort("file",!0)):(n.innerHTML='<i class="fas fa-sort-alpha-down"></i> File Name',this.saveSort("file",!1)),r.default.drawFiles(e)}},{key:"sortUploadDate",value:function(e,t){var n=document.getElementById("fileSortDropdownMenu");e.fileList.fileList=_.sortBy(e.fileList.fileList,[function(e){return e.uploadDate}]),t?(e.fileList.fileList=e.fileList.fileList.reverse(),n.innerHTML='<i class="fas fa-sort-numeric-down"></i> Upload Date',this.saveSort("date",!0)):(n.innerHTML='<i class="fas fa-sort-numeric-up"></i> Upload Date',this.saveSort("date",!1)),r.default.drawFiles(e)}},{key:"sortPrintTime",value:function(e,t){var n=document.getElementById("fileSortDropdownMenu");e.fileList.fileList=_.sortBy(e.fileList.fileList,[function(e){return e.expectedPrintTime}]),t?(e.fileList.fileList=e.fileList.fileList.reverse(),n.innerHTML='<i class="fas fa-sort-numeric-up"></i> Print Time',this.saveSort("time",!1)):(n.innerHTML='<i class="fas fa-sort-numeric-down"></i> Print Time',this.saveSort("time",!0)),r.default.drawFiles(e)}}],(n=null)&&i(t.prototype,n),a&&i(t,a),e}();n.default=o},{"./fileManager.js":8}],10:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a,r=(a=e("../octofarm.js"))&&a.__esModule?a:{default:a};function i(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function o(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var c=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a,c,l;return t=e,n=null,a=[{key:"create",value:(c=regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.default.post("printers/printerInfo");case 2:return n=e.sent,e.next=5,n.json();case 5:e.sent,t.innerHTML="";case 7:case"end":return e.stop()}}),e)})),l=function(){var e=this,t=arguments;return new Promise((function(n,a){var r=c.apply(e,t);function o(e){i(r,n,a,o,l,"next",e)}function l(e){i(r,n,a,o,l,"throw",e)}o(void 0)}))},function(e){return l.apply(this,arguments)})},{key:"addListeners",value:function(){}}],n&&o(t.prototype,n),a&&o(t,a),e}();n.default=c},{"../octofarm.js":11}],11:[function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"get",value:function(e){var t="/".concat(e);return fetch(t,{method:"GET",headers:{"Content-Type":"application/json"}})}},{key:"delete",value:function(e){var t="/".concat(e);return fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json"}})}},{key:"post",value:function(e,t){var n="/".concat(e);return fetch(n,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)})}}],(n=null)&&a(t.prototype,n),r&&a(t,r),e}();n.default=r},{}],12:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=i(e("./functions/ui.js")),r=i(e("./octofarm.js"));i(e("./functions/validate.js")),e("./modules/filamentGrab.js");function i(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n,a,r,i,o){try{var c=e[i](o),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(a,r)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(a,r){var i=e.apply(t,n);function c(e){o(i,a,r,c,l,"next",e)}function l(e){o(i,a,r,c,l,"throw",e)}c(void 0)}))}}function l(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var s=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,i,o,s,u,d,f,p,m,v;return t=e,n=null,i=[{key:"post",value:function(e,t,n){var a="".concat(e.printerURL,"/api/").concat(t);return fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":e.apikey},body:JSON.stringify(n)})}},{key:"folder",value:function(e,t,n){var a="".concat(e.printerURL,"/api/files/").concat(t);return fetch(a,{method:"POST",headers:{"X-Api-Key":e.apikey},body:n})}},{key:"move",value:function(e,t,n){var a="".concat(e.printerURL,"/api/").concat(t);return fetch(a,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":e.apikey},body:JSON.stringify(n)})}},{key:"delete",value:function(e,t){var n="".concat(e.printerURL,"/api/").concat(t);return fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json","X-Api-Key":e.apikey}})}},{key:"selectTool",value:(v=c(regeneratorRuntime.mark((function t(n,a){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(n.printerURL,a),r={command:"select",tool:a},t.next=4,e.post(n,"printer/tool",r);case 4:if(204!==t.sent.status){t.next=9;break}return t.abrupt("return",!0);case 9:return t.abrupt("return",!1);case 10:case"end":return t.stop()}}),t)}))),function(e,t){return v.apply(this,arguments)})},{key:"system",value:(m=c(regeneratorRuntime.mark((function t(n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:i="system/commands/core/"+r,bootbox.confirm({message:"Are your sure you want to ".concat(r," ").concat(n.printerName,"?"),buttons:{cancel:{label:'<i class="fa fa-times"></i> No'},confirm:{label:'<i class="fa fa-check"></i> Yes'}},callback:function(t){return c(regeneratorRuntime.mark((function o(){return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(!t){o.next=5;break}return o.next=3,e.post(n,i);case 3:204===o.sent.status?a.default.createAlert("success","".concat(n.printerName,": ").concat(r," was successful"),3e3,"clicked"):a.default.createAlert("error","".concat(n.printerName,": ").concat(r," was unsuccessful. Please make sure printer is connected and commands are setup in Settings -> Server."),3e3,"clicked");case 5:case"end":return o.stop()}}),o)})))()}});case 2:case"end":return t.stop()}}),t)}))),function(e,t){return m.apply(this,arguments)})},{key:"move",value:(p=c(regeneratorRuntime.mark((function t(n,a,r,i,o){var c,l,s,u;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return c=function(){n.target.classList="btn btn-light"},l="printer/printhead",t.next=5,document.querySelectorAll("#pcAxisSteps > .btn.active");case 5:return s=(s=t.sent)[0].innerHTML,u=null,"home"===r?u={command:r,axes:i}:"jog"===r?(s=Number(null!=o?o+s:s),p=s,(f=i)in(d={command:r})?Object.defineProperty(d,f,{value:p,enumerable:!0,configurable:!0,writable:!0}):d[f]=p,u=d):"feedrate"===r&&(u={command:r,factor:s}),t.next=11,e.post(a,l,u);case 11:204===t.sent.status?(n.target.classList="btn btn-success",setTimeout(c,500)):(n.target.classList="btn btn-danger",setTimeout(c,500));case 13:case"end":return t.stop()}var d,f,p}),t)}))),function(e,t,n,a,r){return p.apply(this,arguments)})},{key:"file",value:(f=c(regeneratorRuntime.mark((function t(n,i,o,c){var l,s,u,d,f,p,m;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(l="files/local/"+i,s=null,"load"!==o){t.next=9;break}return u={command:"select",print:!1},t.next=6,e.post(n,l,u);case 6:s=t.sent,t.next=26;break;case 9:if("print"!==o){t.next=22;break}return d={command:"select",print:!0},f={command:"flowrate",factor:parseInt(n.flowRate)},t.next=14,e.post(n,"printer/tool",f);case 14:return p={command:"feedrate",factor:parseInt(n.feedRate)},t.next=17,e.post(n,"printer/printhead",p);case 17:return t.next=19,e.post(n,l,d);case 19:s=t.sent,t.next=26;break;case 22:if("delete"!==o){t.next=26;break}return t.next=25,e.delete(n,l);case 25:s=t.sent;case 26:if(204!==s.status){t.next=38;break}if("delete"!==o){t.next=35;break}return m={i:n,fullPath:i},t.next=31,r.default.post("printers/removefile",m);case 31:t.sent,a.default.createAlert("success","".concat(n.printerName,": ").concat(o," completed"),3e3,"clicked"),t.next=36;break;case 35:a.default.createAlert("success","".concat(n.printerName,": ").concat(o," actioned"),3e3,"clicked");case 36:t.next=39;break;case 38:a.default.createAlert("error","".concat(n.printerName,": ").concat(o," failed"),3e3,"clicked");case 39:case"end":return t.stop()}}),t)}))),function(e,t,n,a){return f.apply(this,arguments)})},{key:"jobAction",value:(d=c(regeneratorRuntime.mark((function t(n,a,i){var o,l,s,u,d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.default.get("settings/server/get");case 2:return o=t.sent,t.next=5,o.json();case 5:return o=t.sent,l={command:"flowrate",factor:parseInt(n.flowRate)},t.next=9,e.post(n,"printer/tool",l);case 9:return s={command:"feedrate",factor:parseInt(n.feedRate)},t.next=12,e.post(n,"printer/printhead",s);case 12:if(n._id,u=!1,void 0!==o.filament&&(u=o.filament.filamentCheck),d=!1,null!=n.selectedFilament&&Array.isArray(n.selectedFilament)&&(d=n.selectedFilament.every((function(e){return null!==e}))),!u||d||"start"!==a.command){t.next=21;break}bootbox.confirm({message:"You have spools in the inventory, but none selected. Would you like to select a spool?",buttons:{confirm:{label:"Yes",className:"btn-success"},cancel:{label:"No",className:"btn-danger"}},callback:function(t){return c(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!t){r.next=3;break}r.next=15;break;case 3:if(null==n.selectedFilament||!Array.isArray(n.selectedFilament)){r.next=9;break}return o={command:"offset",offsets:{}},n.selectedFilament.forEach((function(e,t){null!=e&&(o.offsets["tool"+t]=e.spools.tempOffset)})),r.next=8,e.post(n,"printer/tool",o);case 8:r.sent;case 9:return r.next=11,e.post(n,"printer/printhead",s);case 11:return r.next=13,e.post(n,"job",a);case 13:r.sent,i.target.disabled=!1;case 15:case"end":return r.stop()}}),r)})))()}}),t.next=27;break;case 21:return t.next=23,e.post(n,"printer/printhead",s);case 23:return t.next=25,e.post(n,"job",a);case 25:t.sent,i.target.disabled=!1;case 27:case"end":return t.stop()}}),t)}))),function(e,t,n){return d.apply(this,arguments)})},{key:"connect",value:(u=c(regeneratorRuntime.mark((function t(n,r){var i;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=null,i="connect"===n?{command:"connect",port:document.getElementById("pmSerialPort").value,baudrate:parseInt(document.getElementById("pmBaudrate").value),printerProfile:document.getElementById("pmProfile").value,save:!0}:{command:"disconnect"},t.next=4,e.post(r,"connection",i);case 4:204===t.sent.status?(a.default.createAlert("success","".concat(r.printerName,": has ").concat(i.command,"ed successfully."),3e3,"click"),"connect"===n?(document.getElementById("pmSerialPort").disabled=!0,document.getElementById("pmBaudrate").disabled=!0,document.getElementById("pmProfile").disabled=!0):(document.getElementById("pmSerialPort").disabled=!1,document.getElementById("pmBaudrate").disabled=!1,document.getElementById("pmProfile").disabled=!1)):a.default.createAlert("error","".concat(r.printerName,": could not ").concat(i.command,"."),3e3,"click");case 6:case"end":return t.stop()}}),t)}))),function(e,t){return u.apply(this,arguments)})},{key:"power",value:(s=c(regeneratorRuntime.mark((function e(t,n,r,i){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.includes("[PrinterURL]")&&(n=n.replace("[PrinterURL]",t.printerURL)),n.includes("[PrinterAPI]")&&(n=n.replace("[PrinterAPI]",t.apikey)),void 0!==i&&0!==i.length){e.next=9;break}return e.next=5,fetch(n,{method:"POST",headers:{"Content-Type":"application/json"}});case 5:204!==e.sent.status?a.default.createAlert("error","".concat(t.printerName,": Could not complete ").concat(r),3e3):a.default.createAlert("success","".concat(t.printerName,": Successfully completed ").concat(r),3e3),e.next=13;break;case 9:return e.next=11,fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":t.apikey},body:i});case 11:204!==e.sent.status?a.default.createAlert("error","".concat(t.printerName,": Could not complete ").concat(r),3e3):a.default.createAlert("success","".concat(t.printerName,": Successfully completed ").concat(r),3e3);case 13:return e.abrupt("return","done");case 14:case"end":return e.stop()}}),e)}))),function(e,t,n,a){return s.apply(this,arguments)})},{key:"getPowerStatus",value:(o=c(regeneratorRuntime.mark((function e(t,n,a){var r,i,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.includes("[PrinterURL]")&&(n=n.replace("[PrinterURL]",t.printerURL)),n.includes("[PrinterAPI]")&&(n=n.replace("[PrinterAPI]",t.apikey)),void 0!==a&&""!=a){e.next=16;break}return e.next=5,fetch(n,{method:"POST",headers:{"Content-Type":"application/json"}});case 5:if(200===(r=e.sent).status&&204===r.status){e.next=10;break}return e.abrupt("return","No Status");case 10:return e.next=12,r.json();case 12:return r=e.sent,e.abrupt("return",r);case 14:e.next=32;break;case 16:return e.prev=16,e.next=19,fetch(n,{method:"POST",headers:{"Content-Type":"application/json","X-Api-Key":t.apikey},body:a});case 19:if(i=e.sent,o="No Status",200!==i.status&&204!==i.status){e.next=25;break}return e.next=24,i.json();case 24:o=e.sent;case 25:(c=document.getElementById("printerStatus-"+t._id))&&("No Status"===o?c.style.color="black":o[Object.keys(o)[0]]?c.style.color="green":c.style.color="red"),e.next=32;break;case 29:e.prev=29,e.t0=e.catch(16),console.log("Printer Power Check failed... classing offline:",e.t0);case 32:case"end":return e.stop()}}),e,null,[[16,29]])}))),function(e,t,n){return o.apply(this,arguments)})}],n&&l(t.prototype,n),i&&l(t,i),e}();n.default=s},{"./functions/ui.js":4,"./functions/validate.js":5,"./modules/filamentGrab.js":7,"./octofarm.js":11}]},{},[1]);
//# sourceMappingURL=fileManagerRunner.min.js.map
